---
phase: 04-json-output-and-llm-ergonomics
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/cli/wt/new.ts
  - src/cli/wt/list.ts
  - src/cli/wt/clean.ts
  - src/cli/wt/link.ts
  - src/cli/wt/state.ts
  - src/cli/wt/config.ts
  - src/cli/wt/prs.ts
  - src/cli/wt/init.ts
autonomous: true

must_haves:
  truths:
    - 'Running `wt --help` lists all 9 subcommands (new, list, clean, link, state, config, init, completion, prs) with accurate short descriptions'
    - 'Running `wt new --help` lists all flags including --json, --non-interactive, --action, --stash-untracked, --pr, --branch, --base, --no-wtlink, --no-hooks, --install, --code, --ready, --draft'
    - 'Running `wt list --help` lists --json, --verbose, --no-status, --no-interactive, --filter, --refresh flags'
    - 'Running `wt clean --help` lists --all, --dry-run, --force, --json, --delete-remote flags'
    - 'Running `wt state --help` lists --json, --verbose, --base-branch flags'
    - 'Running `wt config --help` lists set, get, validate, migrate subcommands in addition to show, init, edit'
    - 'Running `wt prs --help` lists --state, --author, --label, --draft, --no-draft, --with-worktree, --limit, --json, --no-interactive, --refresh flags'
  artifacts:
    - path: 'src/cli/wt/state.ts'
      provides: 'Help text with --base-branch flag'
      contains: 'base-branch'
    - path: 'src/cli/wt/clean.ts'
      provides: 'Help text with --delete-remote flag'
      contains: 'delete-remote'
    - path: 'src/cli/wt/config.ts'
      provides: 'Help text with set/get/validate/migrate subcommands'
      contains: 'validate'
    - path: 'src/cli/wt/list.ts'
      provides: 'Help text with --refresh flag'
      contains: 'refresh'
  key_links:
    - from: 'src/cli/wt/state.ts'
      to: 'src/cli/wtstate.ts'
      via: 'Flag forwarding matches actual wtstate parseArgs()'
      pattern: 'base-branch|baseBranch'
    - from: 'src/cli/wt/config.ts'
      to: 'src/cli/wtconfig.ts'
      via: 'Subcommand list matches actual wtconfig switch cases'
      pattern: 'set|get|validate|migrate'
---

<objective>
Audit and update `--help` text for every `wt` subcommand so that flags, subcommands, and descriptions are accurate and complete — no stale entries, no missing flags.

Purpose: Requirement LLM-02 states that `wt --help` and all subcommand `--help` text must be accurate, complete, and current. The research found that several subcommand wrappers are missing flags that exist in the underlying CLI (e.g., `wt state` missing `--base-branch`, `wt clean` missing `--delete-remote`, `wt config` missing `set/get/validate/migrate`).

Output: All wt subcommand wrapper files have complete, accurate help text matching their underlying CLI tools.
</objective>

<execution_context>
@/home/chris/.claude/get-shit-done/workflows/execute-plan.md
@/home/chris/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-json-output-and-llm-ergonomics/04-RESEARCH.md

@src/cli/wt/new.ts
@src/cli/wt/list.ts
@src/cli/wt/clean.ts
@src/cli/wt/link.ts
@src/cli/wt/state.ts
@src/cli/wt/config.ts
@src/cli/wt/prs.ts
@src/cli/wt/init.ts

# Reference CLIs (to compare flags against):

@src/cli/newpr.ts (parseArgs section)
@src/cli/lswt.ts (parseArgs section)
@src/cli/cleanpr.ts (parseArgs section)
@src/cli/wtstate.ts (parseArgs/getHelpText)
@src/cli/wtlink.ts (yargs options)
@src/cli/wtconfig.ts (showHelp)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and fix wt subcommand help text for state, clean, list, config</name>
  <files>
    src/cli/wt/state.ts
    src/cli/wt/clean.ts
    src/cli/wt/list.ts
    src/cli/wt/config.ts
  </files>
  <action>
    For each file, read the corresponding underlying CLI to find all accepted flags, then update the wt wrapper to expose all flags in yargs `.option()` calls and forward them correctly.

    **wt/state.ts** — Cross-reference with `src/cli/wtstate.ts` and `src/lib/wtstate/index.ts`:
    1. Add `--base-branch` option: `{ type: 'string', description: 'Base branch to compare against (default: from .worktreerc or main)' }`. Forward as `args.push('--base-branch', argv.baseBranch)` in handler.
    2. Verify `--verbose` and `--json` are already present (they are).
    3. Add examples showing `--base-branch` usage.

    **wt/clean.ts** — Cross-reference with `src/cli/cleanpr.ts` parseArgs:
    1. Add `--delete-remote` option: `{ type: 'boolean', description: 'Delete remote branches after cleaning worktree', default: false }`. Forward in handler.
    2. Verify `--all`, `--dry-run`, `--force`, `--json` are present.
    3. Update examples if needed.

    **wt/list.ts** — Cross-reference with `src/cli/lswt.ts` parseArgs:
    1. Add `--refresh` option: `{ type: 'boolean', description: 'Force refresh GitHub PR status (bypass cache)', default: false }`. Forward in handler.
    2. Verify `--verbose`, `--json`, `--no-status`, `--no-interactive`, `--filter` are present.
    3. Update examples if needed.

    **wt/config.ts** — Cross-reference with `src/cli/wtconfig.ts` commands:
    1. Currently the config command delegates to `wtconfig`. Ensure the yargs command definition lists ALL subcommands in its help: `show`, `set`, `get`, `edit`, `validate`, `migrate`, `init`.
    2. Update the `.describe()` or `.usage()` to enumerate all subcommands with brief descriptions.
    3. Add `--json` option at the config command level (not just migrate). Forward it to wtconfig args.
    4. Ensure `set`, `get`, `validate`, `migrate` are documented in the help output (currently only `show`, `init`, `edit` may be listed).

    For all files: Preserve existing behavior. Only add missing options and update help text. Do NOT change the command execution logic beyond flag forwarding.

  </action>
  <verify>
    Run `npm test` — all existing tests pass. Run `npx tsx src/cli/wt.ts state --help`, `npx tsx src/cli/wt.ts clean --help`, `npx tsx src/cli/wt.ts list --help`, `npx tsx src/cli/wt.ts config --help` and verify the new flags appear.
  </verify>
  <done>
    `wt state --help` shows `--base-branch`. `wt clean --help` shows `--delete-remote`. `wt list --help` shows `--refresh`. `wt config --help` lists all 7 subcommands and `--json` flag.
  </done>
</task>

<task type="auto">
  <name>Task 2: Audit and fix wt subcommand help text for prs, link, init, new</name>
  <files>
    src/cli/wt/prs.ts
    src/cli/wt/link.ts
    src/cli/wt/init.ts
    src/cli/wt/new.ts
  </files>
  <action>
    Continue the help text audit for the remaining subcommands:

    **wt/prs.ts** — Cross-reference with `src/cli/prs.ts` yargs options:
    1. Verify all flags are present: `--state`, `--author`, `--label`, `--draft`, `--no-draft`, `--with-worktree`, `--limit`, `--json`, `--no-interactive`, `--refresh`.
    2. Fix any missing flags or incorrect descriptions.
    3. Add/update examples.

    **wt/link.ts** — Cross-reference with `src/cli/wtlink.ts` commands and options:
    1. Verify subcommand list is complete: `link`, `manage`, `validate`, `migrate`.
    2. Ensure `--json`, `--dry-run`, `--manifest-file` are documented.
    3. Update help text to mention that `migrate` is deprecated (use `wt config migrate` instead).

    **wt/init.ts** — Cross-reference with `src/cli/wtconfig.ts` init command:
    1. Verify the description is accurate (delegates to wtconfig init wizard).
    2. This is purely interactive — ensure help text states it clearly.
    3. No `--json` flag needed (research recommendation: skip JSON for interactive-only wizard).

    **wt/new.ts** — Cross-reference with `src/cli/newpr.ts` parseArgs:
    1. Verify all flags are present: `--pr`, `--branch`, `--base`, `--install`, `--code`, `--ready`, `--no-wtlink`, `--no-hooks`, `--json`, `--non-interactive`, `--action`, `--stash-untracked`, `--draft`.
    2. Check that `--action` values list is complete. The valid actions from `src/lib/json-output.ts` are: `empty_commit`, `commit_staged`, `commit_all`, `stash_and_empty`, `use_commits`, `push_then_branch`, `use_commits_and_commit_all`, `use_commits_and_stash`, `create_pr_for_branch`, `pr_for_branch_commit_all`, `pr_for_branch_stash`, `branch_from_detached`. Ensure the help text or choices array includes all of these.
    3. Fix any missing flags or incorrect descriptions.

    For all files: Read the actual underlying CLI entry point to identify the true set of flags, then ensure the wt wrapper's yargs definition matches exactly. Preserve existing handler logic.

  </action>
  <verify>
    Run `npm test` — all existing tests pass. Run `npx tsx src/cli/wt.ts prs --help`, `npx tsx src/cli/wt.ts link --help`, `npx tsx src/cli/wt.ts init --help`, `npx tsx src/cli/wt.ts new --help` and verify completeness.
  </verify>
  <done>
    All 9 `wt` subcommand `--help` outputs list every accepted flag with accurate descriptions. No stale flags, no missing flags.
  </done>
</task>

</tasks>

<verification>
1. `npm test` passes
2. `wt --help` shows all 9 subcommands with descriptions
3. For each subcommand, `wt <cmd> --help` shows all flags matching the underlying CLI's parseArgs/yargs definition
4. No `--help` output references flags that don't exist or misses flags that do
</verification>

<success_criteria>

- All `wt` subcommand help text is accurate and complete
- Missing flags (`--base-branch`, `--delete-remote`, `--refresh`, config subcommands) are added
- `--action` choices in `wt new --help` include all 12 valid StateActionKey values
- All 3134+ existing tests pass
  </success_criteria>

<output>
After completion, create `.planning/phases/04-json-output-and-llm-ergonomics/04-02-SUMMARY.md`
</output>
